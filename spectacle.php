<html>
	<head>
		<title>Festival Théâtres de Bourbon : Spectacle par spectacle</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="styleTheatresDeBourbonPourPHP.css">
	</head>
	
	<body>
		<div class="bandeau">				
			<h1> Festival Théâtres de Bourbon : Spectacle par spectacle </h1>
		</div ><!--class="bandeau"-->

		<div class="panierFinal">
				<a href="panier.php"><img src="panier2.jpg" alt="imgPanier"></a>
				</br>
				<span>Panier</span>

		</div><!-- class="panierFinal"-->	
		<div class="menu">
			<ul class="nav">
				<a href="index.php">Le site :</a>
				<li><a href="jours.php">Jour par Jour</a></li>
				<li><a href="lieu.php">Lieu par Lieu</a></li>
				<li><a href="spectacle.php">Spectacles</a></li>
				<li><a href = "panier.php">Panier</a></li>
			</ul>			
			<div class="riquiqui">
				<ul class="nav"> <!-- id labelSpectacle qui permet de se rendre à partir du menu directement sur le spectacle recherché sur la page-->
					<a href="#labelSpectacle1">
						<li><titreSpectacle> Barbara, où rêvent mes saisons <titreSpectacle></li>
					</a>
					<a href="#labelSpectacle2">
					    <li><titreSpectacle> Fricassée de berniques sur lit de Prévert </titreSpectacle></li>
					</a>
					<a href="#labelSpectacle3">
					    <li><titreSpectacle> Hugo es tu là? </titreSpectacle></li>
					</a>
					<a href="#labelSpectacle4">
					    <li><titreSpectacle> La demande en mariage et L'ours </titreSpectacle></li>
					</a>
					<a href="#labelSpectacle5">
					    <li><titreSpectacle> La gloire de mon père </titreSpectacle></li>
					</a>
					<a href="#labelSpectacle6">
					    <li><titreSpectacle> La promesse de l'aube </titreSpectacle></li>
					</a>															
 					<a href="#labelSpectacle7">
						 <li><titreSpectacle> Le Tartuffe ou l'imposteur<titreSpectacle></l>
					</a>
					<a href="#labelSpectacle8">
						 <li><titreSpectacle> Le château de ma mère <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle9">
						 <li><titreSpectacle> Le marchand de Venise <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle10">
						 <li><titreSpectacle> Le mariage <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle11">
						 <li><titreSpectacle> Le prophète <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle12">
						 <li><titreSpectacle> Les confessions : Les années de Jeunesse <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle13">
						 <li><titreSpectacle> Les confessions : Les années de Maturité <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle14">
						 <li><titreSpectacle> Les confessions : Les années de Sagesse <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle15">
						 <li><titreSpectacle> Les soliloques de Mariette <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle16">
						 <li><titreSpectacle> Mademoiselle Julie <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle17">
						 <li><titreSpectacle> Port Racines <titreSpectacle></l>
					</a>
					<a href="#labelSpectacle18">
						 <li><titreSpectacle> Titre Provisoire <titreSpectacle></l>
					</a>
				</ul>
			</div><!--class="riquiqui"-->
		</div>
			<main>
				<div class="decalage">
					<div class="Lieu">
						<p>	
						Dès cette première édition, le festival propose une programmation ambitieuse et riche. Les troupes participantes sont toutes aguerries et professionnelles et elles ont comme nous une approche passionnée du théâtre. 
						Cet événement se veut novateur et ambitieux, puisque l'excellence des spectacles sera accessible à tous, dans une ambiance amicale et chaleureuse.
					</p>
						<h2> Notre programmation...</h2>
						<h3> ...18 spectacles sélectionnés pour vous par notre directeur artistique.
						</h3>
						<p><li><titreSpectacle>Barbara, où rêvent mes saisons?</titreSpectacle>,
								d’après 
								<Auteur>Barbara et Sophie Pincemaille </Auteur>.	
							</li>
							<li><titreSpectacle>Le château de ma mère</titreSpectacle>,
								d’après 
								<Auteur>Marcel Pagnol</Auteur>.	
							</li>
							<li>
								Un triptyque sur 3 jour tiré 
								<titreSpectacle>des confessions</titreSpectacle>, 
								de 
								<Auteur>Saint Augustin</Auteur>.
							</li>
							<li>	
								<titreSpectacle>La demande en mariage et l’ours</titreSpectacle>, 
								de 
								<Auteur>Tchekhov</Auteur>.	
							</li> 
							<li>	<titreSpectacle>Fricassée de Berniques sur lit de Prévert</titreSpectacle>, lectures choisies de 
								<Auteur>Prévert</Auteur> parsemées de chansons.
							</li> 	
							<li><titreSpectacle>La gloire de mon père</titreSpectacle>, d’après 
								<Auteur>Marcel Pagnol</Auteur>. 
							</li>
							<li><titreSpectacle>Hugo démasqué</titreSpectacle>, d’après 
								<Auteur>Victor Hugo</Auteur>. 
							</li>
							<li><titreSpectacle>Mademoiselle Julie</titreSpectacle>, 
								d'<Auteur>August Stringberg</Auteur>. 
							</li>	
							<li><titreSpectacle>Le Marchand de Venise</titreSpectacle>, 
								de 
								<Auteur>Shakespeare</Auteur>. 
							</li>
							<li><titreSpectacle>Le mariage</titreSpectacle>, 
								de <Auteur>Jean Luc Jeener</Auteur>.
							</li>
							<li><titreSpectacle>La promesse de l'aube</titreSpectacle>, 
								tirée de l'œuvre de 
								<Auteur>Romain Gary</Auteur>. 
							</li>
							<li><titreSpectacle>Port racines</titreSpectacle>, 
								création de 
								<Auteur>labelle et Cie</Auteur>.
							</li>
							<li><titreSpectacle>Le prophète</titreSpectacle>, 
								de 
								<Auteur>Khalil Gilbran</Auteur>.
							</li>
							<li><titreSpectacle>Les soliloques de Mariette</titreSpectacle>, 
								tirée de Belle du Seigneur, d'<Auteur>Albert Cohen</Auteur>.
							</li>
							<li><titreSpectacle>le Tartuffe ou l'imposteur</titreSpectacle>, 
								de 
								<Auteur>Molière</Auteur>. 
							</li>
							<li><titreSpectacle>titre Provisoire</titreSpectacle>, 
								de 
								<Auteur>Pauline Mornet</Auteur>, notre <a href="presentation.php#label_carteBlanche">carte blanche</a>. 
							</li>
							<h2> navigation au coeur des spectacles</h2>
					
						<p>
						Dans la liste indiquant notre programmation un clic sur le titre du spectacle vous orientera directement vers son résumé et ses dates de représentations.
						Réprésentations que vous pourrez alors choisir de mettre dans le panier pour y réserver ensuite des places (dès la réservation ouverte).
						Quand un clic sur le nom de la compagnie vous redirigera vers son site web professionnel.
						Vous pouvez aussi accèder directement au détail d'un spectacle en cliquant simplement sur son affiche miniature.
						Pour revenir ici, il vous suffit de cliquer de nouveau sur l'onglet "spectacles" dans le menu du site.
						Vous pouvez aussi dérouler la description de tous les spectacles dans l'ordre alphabetique de titre via l'asenceur de votre navigateur. 
						</p>

					</div>

			<?php 
				if (($handle = fopen("ResultatsFestival.csv", "r")) !== FALSE) {
					fgetcsv($handle, 1000, ",");//On retire la 1ere ligne du csv (legendes)
					$spectacle = "null";
					$tab = array();
					while (($data = fgetcsv($handle, 1000, "\n")) !== FALSE) {
						
						foreach($data as $value) {
							$replaced = preg_replace_callback( // pour résoudre le problème de Barbara
								'/"(\\\\[\\\\"]|[^\\\\"])*"/',
								function ($match){
										$match = preg_replace("[,]", '&#44;', $match); //remplace les virgules par le symbole html
										$match = preg_replace("[\"]", '', $match); //retire les guillemets
										implode($match); //concatene le tout
										return $match[0]; //probleme: cree un tableau dont la 1ere case contient ce que l'on veut :/
								},
								$value
							);
							
							$replaced = preg_replace("[']", '&#146;', $replaced); //remplace les apostrophes par le symbole html
							
							$fields = preg_split("[,]", $replaced);
							array_push($tab, $fields);
						}
					}

					$sort_spec = array();	//Pour y mettre le tableau trié en fonction des spectacles
					$last_spec = "null";
					while(count($tab)>0){ 
						foreach($tab as $line){//parcourir le tableau pour chercher le nouveau $last_spec
							if($last_spec!= $line[2]){
								$last_spec = $line[2];
								break 1;
							}
						}
						$tab_asso = array(); //tableau pour mettre les spectacles en fonction du last_spec et est réinitialiser pour le prochain last_spec
						foreach($tab as $i => $line){
							if($tab[$i][2] == $last_spec){	 //si le titreDeSpectacle est égale au last_spec alors on met sa ligne le concernant dans tab_asso et on retire la ligne de tab
								array_push($tab_asso, $tab[$i]);
								unset($tab[$i]);
							}	
						}
						$sort_spec[$last_spec] = $tab_asso;
					}  
					ksort($sort_spec);

					$i =0;
					foreach($sort_spec as $key => $value){	$i=$i+1;//Boucle pour l'affichage html
						foreach($value as $key2 => $value2){
						

							if($spectacle != $key){
								if($spectacle != "null"){
									echo "</table>\n";
									echo "</div><!--class=\"Spectacle\"-->\n";
									
								}
								$spectacle = $key;
								echo "<div class=\"Spectacle\">\n";
								echo "<h2><titreSpectacle id=\"" . "labelSpectacle" . $i . "\"> " . $spectacle . "</titreSpectacle>" .", par <troupe> ". $value2[5] . "</troupe></h2>\n";
								echo "<figure id=\"spectacle\">\n";
								echo "<img src = \"".$i .".jpg"."\"/ alt=\" " . $key . " " ."ATTENTION ERREUR de chargement d'image"."\" width= \"100%\" height= \"100%\">";
								echo "</figure>";
								echo "<table>\n";
							}
						
							echo "<tr>\n<td>";
							echo "<Horaire> Le " . $value2[0] . " " . " à " . $value2[1] . "</Horaire>, " . "au <Lieu>" . $value2[3] . " à " . $value2[4] . "</Lieu>, par <troupe>" . $value2[5] . "</troupe><br/>\n";
							echo "</td>\n <td>";
							echo "<form action='reservation.php' method='post'>\n";
							echo "<input type=\"submit\" value=\"Reserver\">\n";
							echo "<input name='titre' type=hidden value=\"" . $value2[2] . "\">\n";
							echo "<input name='date' type=hidden value=\"" . $value2[0] . "\">\n";
							echo "<input name='heure' type=hidden value=\"" . $value2[1] . "\">\n";
							echo "<input name='lieu' type=hidden value=\"" . $value2[3] . "\">\n";
							echo "<input name='ville' type=hidden value=\"" . $value2[4] . "\">\n";
							echo "<input name='troupe' type=hidden value=\"" . $value2[5] . "\">\n";
							echo "\n</form> \n</td> \n</tr>\n";						
						}
					}
					
				
					echo "</table>\n";
					echo "</div><!--class=\"decalage\"-->\n</main>\n";
					fclose($handle);
					
				}
			?>
	</body>
</html>
